<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VideoTube Kids</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #f9f9f9; overflow-x: hidden; height: 100vh; width: 100vw; position: relative; }
        
        /* --- ESTILO DO APP DE VÍDEO --- */
        #app-view { display: block; width: 100%; height: 100%; padding-bottom: 60px; overflow-y: auto; }
        .header { background-color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 10; }
        .logo { font-weight: bold; font-size: 22px; color: #ff0000; display: flex; align-items: center; gap: 5px; }
        .search-container { width: 60%; position: relative; }
        .search-bar { background: #f0f0f0; border:none; border-radius: 20px; padding: 8px 15px; width: 100%; color: #333; font-size: 14px; outline: none; }
        .video-grid { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 15px; }
        .video-card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; }
        .thumbnail { width: 100%; height: 200px; background-color: #000; position: relative; }
        .thumbnail img { width: 100%; height: 100%; object-fit: cover; }
        .info { padding: 10px; }
        .title { font-weight: bold; font-size: 14px; margin-bottom: 5px; color: #333; }
        
        /* Modal do Player de Vídeo */
        #video-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 2000; flex-direction: column; justify-content: center; }
        #video-modal.active { display: flex; }
        .close-video { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; z-index: 2001; }
        .video-frame { width: 100%; height: 100%; border: none; }

        /* --- CONFIGURAÇÕES E SEGREDO --- */
        #settings-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; transform: translateY(100%); transition: transform 0.3s; display: flex; flex-direction: column; }
        #settings-modal.open { transform: translateY(0); }
        .copyright { margin-top: 50px; text-align: center; color: #ccc; font-size: 12px; padding: 20px; user-select: none; }

        /* --- ESTILO DO CHAT SECRETO --- */
        #secret-chat { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; z-index: 999; flex-direction: column; color: white; }
        .connect-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #121212; z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .id-display { font-size: 32px; font-weight: bold; margin: 20px 0; letter-spacing: 2px; color: #00C851; font-family: monospace; text-align: center; }
        .id-input { background: #2a2a2a; border: 1px solid #333; padding: 15px; border-radius: 10px; color: white; width: 100%; margin-bottom: 15px; text-align: center; font-size: 20px; letter-spacing: 1px; }
        .btn { background: #007bff; color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; width: 100%; font-size: 16px; margin-bottom: 10px; }
        
        .chat-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 14px; word-wrap: break-word; }
        .message.sent { align-self: flex-end; background: #007bff; color: white; }
        .message.received { align-self: flex-start; background: #2a2a2a; color: white; }
        .input-area { padding: 10px; background: #1f1f1f; display: flex; gap: 10px; }
        .chat-input { flex: 1; background: #333; border: none; color: white; padding: 10px; border-radius: 20px; }
        
        .error-log { color: #ff4444; font-size: 12px; margin-top: 10px; text-align: center; }
    </style>
</head>
<body>

    <div id="app-view">
        <div class="header">
            <div class="logo"><i class="fab fa-youtube"></i> KidsTube</div>
            <div class="search-container">
                <input type="text" class="search-bar" id="searchInput" placeholder="Buscar vídeos..." onkeypress="handleSearch(event)">
            </div>
            <i class="fas fa-cog" style="color: #606060; font-size: 20px;" onclick="openSettings()"></i>
        </div>
        <div class="video-grid" id="videoGrid">
            </div>
    </div>

    <div id="video-modal">
        <div class="close-video" onclick="closeVideo()">&times;</div>
        <iframe class="video-frame" id="ytPlayer" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>

    <div id="settings-modal">
        <div style="padding: 15px; border-bottom: 1px solid #eee;">
            <i class="fas fa-arrow-left" onclick="closeSettings()"></i> Configurações
        </div>
        <div style="padding: 20px;">
            <p>Modo Restrito: Ativado</p>
            <p>Economia de Bateria: Desativado</p>
            <div class="copyright" id="copyrightTrigger">© 2026 VideoTube Inc. v3.0</div>
        </div>
    </div>

    <div id="secret-chat">
        <div class="connect-screen" id="connectScreen">
            <h3>CHAT SEGREDO</h3>
            <p style="color: #888;">Digite o número do outro celular</p>
            
            <div style="color: #888; margin-top: 20px; font-size: 12px;">SEU NÚMERO:</div>
            <div class="id-display" id="myId">...</div>
            
            <input type="number" id="friendId" class="id-input" placeholder="Número do amigo">
            <button class="btn" onclick="connectToPeer()">CHAMAR / CONECTAR</button>
            <div class="error-log" id="statusLog">Status: Aguardando...</div>
        </div>

        <div id="chatInterface" style="display:none; flex-direction: column; height: 100%;">
            <div style="padding: 15px; background: #1f1f1f; display: flex; justify-content: space-between; align-items: center;">
                <span style="color: #00C851;">● Conectado</span>
                <i class="fas fa-times" onclick="location.reload()" style="color: white;"></i>
            </div>
            <div class="chat-area" id="chatArea"></div>
            <div class="input-area">
                <input type="text" class="chat-input" id="msgInput" placeholder="Mensagem...">
                <button onclick="sendMessage()" style="background:none; border:none; color:#007bff; font-size: 20px;"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. CONFIGURAÇÃO DE VÍDEOS (YOUTUBE REAL)
        // ==========================================
        
        // COLOQUE SUA API KEY AQUI DENTRO DAS ASPAS SE TIVER UMA
        const YOUTUBE_API_KEY = "AIzaSyDPBmGr-woR6-PuvjFQv_DqeopJ0EVMyMs"; 
        
        // Lista de backup caso não tenha API Key (para não ficar vazio)
        const backupVideos = [
            { id: "MmB9b5njVbA", title: "Minecraft: Sobrevivência #1" },
            { id: "gW6226T9E9c", title: "Como fazer slime colorido" },
            { id: "9unCj2k7yL8", title: "Roblox: O novo update" },
            { id: "jNQXAC9IVRw", title: "Bob Esponja em Português" }
        ];

        async function searchVideos(query) {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = '<p style="text-align:center; padding:20px;">Carregando...</p>';

            if (!YOUTUBE_API_KEY) {
                // Sem API Key? Usa o backup simulando uma busca
                setTimeout(() => renderVideos(backupVideos), 500);
                return;
            }

            try {
                // Busca real na API do YouTube (Filtro SafeSearch ativo)
                const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${query}&safeSearch=strict&type=video&key=${YOUTUBE_API_KEY}`);
                const data = await res.json();
                
                if (data.error) {
                    console.error("Erro API:", data.error);
                    renderVideos(backupVideos); // Fallback se a chave der erro
                } else {
                    const videos = data.items.map(item => ({
                        id: item.id.videoId,
                        title: item.snippet.title,
                        thumb: item.snippet.thumbnails.high.url
                    }));
                    renderVideos(videos);
                }
            } catch (e) {
                renderVideos(backupVideos);
            }
        }

        function renderVideos(list) {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = "";
            list.forEach(v => {
                const thumbUrl = v.thumb || `https://img.youtube.com/vi/${v.id}/hqdefault.jpg`;
                const div = document.createElement('div');
                div.className = 'video-card';
                div.innerHTML = `
                    <div class="thumbnail"><img src="${thumbUrl}"></div>
                    <div class="info"><div class="title">${v.title}</div></div>
                `;
                div.onclick = () => playVideo(v.id);
                grid.appendChild(div);
            });
        }

        function playVideo(id) {
            const modal = document.getElementById('video-modal');
            const player = document.getElementById('ytPlayer');
            player.src = `https://www.youtube.com/embed/${id}?autoplay=1`;
            modal.classList.add('active');
        }

        function closeVideo() {
            document.getElementById('video-modal').classList.remove('active');
            document.getElementById('ytPlayer').src = "";
        }

        function handleSearch(e) {
            if (e.key === 'Enter') searchVideos(e.target.value);
        }

        // Carregar vídeos iniciais
        searchVideos("desenhos infantis");

        // ==========================================
        // 2. LÓGICA DO SEGREDO (4 Cliques + Voltar)
        // ==========================================
        function openSettings() { document.getElementById('settings-modal').classList.add('open'); }
        function closeSettings() { document.getElementById('settings-modal').classList.remove('open'); }

        let clicks = 0;
        document.getElementById('copyrightTrigger').addEventListener('click', () => {
            clicks++;
            if (clicks === 4) {
                // Adiciona estados no histórico para o botão voltar funcionar como gatilho
                history.pushState({p:1}, "s1", "?s=1");
                history.pushState({p:2}, "s2", "?s=2");
                
                window.onpopstate = (e) => {
                    if (clicks >= 4) {
                        document.getElementById('settings-modal').classList.remove('open');
                        document.getElementById('app-view').style.display = 'none';
                        document.getElementById('secret-chat').style.display = 'flex';
                        initChatSystem(); // Inicia o PeerJS só agora
                    }
                };
            }
        });

        // ==========================================
        // 3. CHAT P2P COM ID CURTO (NUMÉRICO)
        // ==========================================
        let peer;
        let conn;
        // Gera um número aleatório de 10 dígitos (ex: 1234567890)
        const myNumber = Math.floor(1000000000 + Math.random() * 9000000000).toString();

        function initChatSystem() {
            document.getElementById('myId').innerText = myNumber;
            
            // Tenta registrar esse número no servidor do PeerJS
            peer = new Peer(myNumber, {
                debug: 1
            });

            peer.on('open', (id) => {
                logStatus("Seu número está ativo: " + id);
            });

            peer.on('connection', (c) => {
                // Alguém te chamou
                conn = c;
                setupConnection();
            });

            peer.on('error', (err) => {
                console.log(err);
                if (err.type === 'unavailable-id') {
                    logStatus("Erro: Este número já existe. Recarregue.");
                } else {
                    logStatus("Erro de conexão: " + err.type);
                }
            });
        }

        function connectToPeer() {
            const targetId = document.getElementById('friendId').value;
            if (targetId.length < 5) {
                logStatus("Número inválido.");
                return;
            }
            logStatus("Chamando " + targetId + "...");
            conn = peer.connect(targetId);
            
            // Precisamos esperar a conexão abrir para confirmar
            conn.on('open', () => {
                setupConnection();
            });
            
            // Se demorar 5s e não conectar
            setTimeout(() => {
                if (!conn || !conn.open) logStatus("Sem resposta. Verifique o número.");
            }, 5000);
        }

        function setupConnection() {
            document.getElementById('connectScreen').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'flex';
            
            conn.on('data', (data) => {
                addMessage(data, 'received');
            });
            
            conn.on('close', () => {
                alert("O outro usuário saiu.");
                location.reload();
            });
        }

        function sendMessage() {
            const input = document.getElementById('msgInput');
            const txt = input.value;
            if (!txt) return;
            
            // Filtro de palavrão básico
            const cleanTxt = txt.replace(/merda|porra|caralho/gi, "***");

            if (conn && conn.open) {
                conn.send(cleanTxt);
                addMessage(cleanTxt, 'sent');
                input.value = "";
            } else {
                alert("Você não está conectado.");
            }
        }

        function addMessage(txt, type) {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.innerText = txt;
            document.getElementById('chatArea').appendChild(div);
        }

        function logStatus(msg) {
            document.getElementById('statusLog').innerText = msg;
        }

    </script>
</body>
</html>
